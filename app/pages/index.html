<!DOCTYPE html>
<!-- saved from url=(0139)index.html -->
<html lang="en"><head><style>html{background:#0a0a0a}</style><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - D-PlaneOS</title>
  <link rel="stylesheet" href="/assets/css/design-tokens.css">
  <link rel="stylesheet" href="/assets/css/m3-tokens.css">
  <link rel="stylesheet" href="/assets/css/m3-components.css">
  <link rel="stylesheet" href="/assets/css/m3-icons.css">
  <link rel="stylesheet" href="/assets/css/enhanced-ui.css">
  <link rel="stylesheet" href="/assets/css/m3-animations.css">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif; background: #0a0a0a; color: #fff; overflow-x: hidden; cursor: default; }
    
    
    
    .logo { 
      font-size: 20px; 
      font-weight: 800; 
      color: var(--primary); 
      letter-spacing: -0.5px; 
      cursor: pointer; 
    }
    
    
    
    
    
    
    .main { max-width: 1600px; margin: 140px auto 60px; padding: 0 40px; }
    .page-header { margin-bottom: 48px; display: flex; align-items: center; justify-content: space-between; }
    .page-title { font-size: 32px; font-weight: 700; letter-spacing: -1.5px; }
    .page-meta { font-size: 14px; color: rgba(255,255,255,0.5); }
    
    .grid { display: grid; gap: 24px; margin-bottom: 48px; }
    .grid-4 { grid-template-columns: repeat(4, 1fr); }
    .grid-3 { grid-template-columns: repeat(3, 1fr); }
    .grid-2 { grid-template-columns: repeat(2, 1fr); }
    
    .card { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: var(--radius-xl); padding: 24px; transition: all 0.3s; cursor: pointer; position: relative; overflow: hidden; }
    .card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.05); opacity: 0; transition: opacity 0.3s; pointer-events: none; }
    .card:hover { border-color: rgba(102, 126, 234, 0.4); transform: translateY(-2px); }
    .card:hover::before { opacity: 1; }
    .card:active { transform: translateY(0); }
    
    .stat-card { text-align: center; padding: 32px 24px; cursor: default; }
    .stat-icon { font-size: 40px; color: var(--primary); margin-bottom: 12px; }
    .stat-value { font-size: 36px; font-weight: 700; margin-bottom: 8px; }
    .stat-label { font-size: 14px; color: rgba(255,255,255,0.6); }
    .stat-progress { height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; margin-top: 12px; overflow: hidden; }
    .stat-progress-bar { height: 100%; background: linear-gradient(90deg, var(--primary), var(--primary)); border-radius: 2px; transition: width 0.5s; }
    
    .card-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
    .card-title { font-size: 18px; font-weight: 700; }
    .card-action { width: 32px; height: 32px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s; }
    .card-action:hover { background: rgba(255,255,255,0.1); border-color: rgba(102, 126, 234, 0.5); }
    
    .quick-action { display: flex; align-items: center; gap: 16px; padding: 16px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08); border-radius: 12px; cursor: pointer; transition: all 0.3s; }
    .quick-action:hover { background: rgba(255,255,255,0.05); border-color: rgba(102, 126, 234, 0.4); transform: translateX(4px); }
    .quick-action-icon { font-size: 32px; color: var(--primary); }
    .quick-action-info { flex: 1; }
    .quick-action-title { font-size: 15px; font-weight: 600; margin-bottom: 4px; }
    .quick-action-desc { font-size: 13px; color: rgba(255,255,255,0.5); }
    
    .activity-item { display: flex; align-items: start; gap: 12px; padding: 12px; border-radius: 8px; transition: background 0.3s; cursor: pointer; }
    .activity-item:hover { background: rgba(255,255,255,0.03); }
    .activity-icon { font-size: 20px; color: rgba(255,255,255,0.6); margin-top: 2px; }
    .activity-content { flex: 1; }
    .activity-text { font-size: 14px; margin-bottom: 4px; }
    .activity-time { font-size: 12px; color: rgba(255,255,255,0.4); }
    
    .pool-item { display: flex; align-items: center; gap: 16px; padding: 16px; background: rgba(255,255,255,0.03); border-radius: 12px; margin-bottom: 12px; cursor: pointer; transition: all 0.3s; }
    .pool-item:hover { background: rgba(255,255,255,0.05); }
    .pool-icon { font-size: 32px; color: var(--primary); }
    .pool-info { flex: 1; }
    .pool-name { font-size: 16px; font-weight: 600; margin-bottom: 4px; }
    .pool-details { font-size: 13px; color: rgba(255,255,255,0.5); }
    .pool-status { padding: 4px 10px; background: rgba(16, 185, 129, 0.2); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 6px; font-size: 12px; color: var(--success); }
    
    .container-item { display: flex; align-items: center; gap: 16px; padding: 12px; background: rgba(255,255,255,0.02); border-radius: 8px; margin-bottom: 8px; cursor: pointer; transition: all 0.3s; }
    .container-item:hover { background: rgba(255,255,255,0.05); }
    .container-icon { font-size: 24px; color: var(--primary); }
    .container-name { font-size: 14px; font-weight: 500; margin-bottom: 2px; }
    .container-meta { font-size: 12px; color: rgba(255,255,255,0.4); }
    
    .alert { padding: 16px 20px; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 12px; display: flex; align-items: center; gap: 12px; margin-bottom: 12px; cursor: pointer; transition: all 0.3s; }
    .alert:hover { background: rgba(239, 68, 68, 0.15); }
    .alert-icon { font-size: 24px; color: var(--error); }
    .alert-text { flex: 1; font-size: 14px; }
    
    .fab { position: fixed; bottom: 32px; right: 32px; width: 64px; height: 64px; background: linear-gradient(135deg, var(--primary) 0%, var(--primary) 100%); border-radius: 20px; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 32px rgba(102, 126, 234, 0.4); cursor: pointer; transition: all 0.3s; border: none; color: #fff; }
    .fab:hover { transform: translateY(-4px) scale(1.05); box-shadow: 0 12px 48px rgba(102, 126, 234, 0.6); }
    .fab:active { transform: translateY(-2px) scale(1); }
    
    .context-menu { position: fixed; background: rgba(20, 20, 20, 0.95); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 12px; padding: 8px; box-shadow: 0 8px 32px rgba(0,0,0,0.6); z-index: 10000; display: none; min-width: 200px; }
    .context-menu-item { padding: 10px 16px; border-radius: 8px; cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 12px; transition: background 0.2s; }
    .context-menu-item:hover { background: rgba(255,255,255,0.1); }
    .context-menu-item span { font-size: 18px; color: rgba(255,255,255,0.8); }
    
    @media (max-width: 1024px) {
      .grid-4 { grid-template-columns: repeat(2, 1fr); }
      .grid-3 { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 768px) {
      .grid-4, .grid-3, .grid-2 { grid-template-columns: 1fr; }
    }
  </style>
<style type="text/css" id="operaUserStyle"></style><link rel="stylesheet" href="/assets/css/ui-components.css">
<script src="/assets/js/core.js"></script>
<script src="/assets/js/nav-flyout.js"></script>
<script src="/assets/js/hybrid-router.js"></script>
  <script src="/assets/js/enhanced-ui.js"></script>
  <script src="/assets/js/connection-monitor.js"></script>
  <script src="/assets/js/keyboard-shortcuts.js"></script>
  <script src="/assets/js/form-validator.js"></script>
  <link rel="stylesheet" href="/assets/css/material-symbols-local.css">
  <link rel="stylesheet" href="/assets/css/ui-consistency.css">
  <link rel="stylesheet" href="/assets/css/ui-polish.css">
  <script src="/assets/js/daemon-api.js"></script>
</head>
<body>
  <!-- D-PlaneOS v2.1.0 - Hierarchical Navigation -->
<!-- This navigation maintains all security (CSRF, Auth) and real system state -->

<nav class="nav-container">
  <div class="nav-main">
    <div style="display: flex; align-items: center; gap: 16px;">
      <div class="logo">
        D-PlaneOS
        <span class="version-badge">v2.1.0</span>
      </div>
    </div>
    
    <div class="nav-links">
      <button class="nav-link" onclick="navigateToSection('dashboard')" data-section="dashboard">
        Dashboard
      </button>
      <button class="nav-link" onclick="toggleSubNav('storage', this)" data-section="storage">
        Storage
      </button>
      <button class="nav-link" onclick="toggleSubNav('compute', this)" data-section="compute">
        Compute
      </button>
      <button class="nav-link" onclick="toggleSubNav('network', this)" data-section="network">
        Network
      </button>
      <button class="nav-link" onclick="toggleSubNav('identity', this)" data-section="identity">
        Identity
      </button>
      <button class="nav-link" onclick="toggleSubNav('security', this)" data-section="security">
        Security
      </button>
      <button class="nav-link" onclick="toggleSubNav('system', this)" data-section="system">
        System
      </button>
    </div>
    
    <div class="nav-actions">
      <button class="nav-action-btn" onclick="showKeyboardHelp()" title="Keyboard Shortcuts (?)">
        <span class="material-symbols-rounded">keyboard</span>
      </button>
      <div class="connection-status online" id="navConnectionStatus">
        <span class="status-dot"></span>
        <span>Connected</span>
      </div>
    </div>
  </div>

  <!-- Storage Sub-Navigation -->
  <div id="sub-storage" class="nav-sub">
    <div class="nav-sub-inner">
      <a href="pools.html" class="sub-link" data-page="pools">
        <span class="material-symbols-rounded">database</span>
        ZFS Pools
      </a>
      <a href="pools-advanced.html" class="sub-link" data-page="pools-advanced">
        <span class="material-symbols-rounded">photo_camera</span>
        Snapshots
      </a>
      <a href="shares.html" class="sub-link" data-page="shares">
        <span class="material-symbols-rounded">folder_shared</span>
        Shares
      </a>
      <a href="replication.html" class="sub-link" data-page="replication">
        <span class="material-symbols-rounded">sync</span>
        Replication
      </a>
      <a href="files.html" class="sub-link" data-page="files">
        <span class="material-symbols-rounded">folder_open</span>
        File Explorer
      </a>
      <a href="quotas.html" class="sub-link" data-page="quotas">
        <span class="material-symbols-rounded">pie_chart</span>
        Quotas
      </a>
      <a href="snapshot-scheduler.html" class="sub-link" data-page="snapshot-scheduler">
        <span class="material-symbols-rounded">schedule</span>
        Snapshot Scheduler
      </a>
      <a href="acl-manager.html" class="sub-link" data-page="acl-manager">
        <span class="material-symbols-rounded">admin_panel_settings</span>
        ACL Manager
      </a>
      <a href="zfs-encryption.html" class="sub-link" data-page="zfs-encryption">
        <span class="material-symbols-rounded">enhanced_encryption</span>
        Encryption
      </a>
      <a href="files-enhanced.html" class="sub-link" data-page="files-enhanced">
        <span class="material-symbols-rounded">upload_file</span>
        File Upload
      </a>
      <a href="cloud-sync.html" class="sub-link" data-page="cloud-sync">
        <span class="material-symbols-rounded">cloud_sync</span>
        Cloud Sync
      </a>
    </div>
  </div>

  <!-- Compute Sub-Navigation -->
  <div id="sub-compute" class="nav-sub">
    <div class="nav-sub-inner">
      <a href="docker.html" class="sub-link" data-page="docker">
        <span class="material-symbols-rounded">dns</span>
        Docker Containers
      </a>
      <a href="modules.html" class="sub-link" data-page="modules">
        <span class="material-symbols-rounded">extension</span>
        App Modules
      </a>
    </div>
  </div>

  <!-- Network Sub-Navigation -->
  <div id="sub-network" class="nav-sub">
    <div class="nav-sub-inner">
      <a href="network.html" class="sub-link" data-page="network">
        <span class="material-symbols-rounded">lan</span>
        Network Settings
      </a>
      <a href="network-interfaces.html" class="sub-link" data-page="network-interfaces">
        <span class="material-symbols-rounded">settings_ethernet</span>
        Interfaces
      </a>
      <a href="network-dns.html" class="sub-link" data-page="network-dns">
        <span class="material-symbols-rounded">dns</span>
        DNS
      </a>
      <a href="network-routing.html" class="sub-link" data-page="network-routing">
        <span class="material-symbols-rounded">route</span>
        Routing
      </a>
    </div>
  </div>

  <!-- Identity Sub-Navigation -->
  <div id="sub-identity" class="nav-sub">
    <div class="nav-sub-inner">
      <a href="users.html" class="sub-link" data-page="users">
        <span class="material-symbols-rounded">person</span>
        Users
      </a>
      <a href="groups.html" class="sub-link" data-page="groups">
        <span class="material-symbols-rounded">group</span>
        Groups
      </a>
      <a href="directory-service.html" class="sub-link" data-page="directory-service">
        <span class="material-symbols-rounded">domain</span>
        Directory Service
      </a>
      <a href="rbac-management.html" class="sub-link" data-page="rbac-management">
        <span class="material-symbols-rounded">admin_panel_settings</span>
        Roles & Permissions
      </a>
    </div>
  </div>

  <!-- Security Sub-Navigation -->
  <div id="sub-security" class="nav-sub">
    <div class="nav-sub-inner">
      <a href="security.html" class="sub-link" data-page="security">
        <span class="material-symbols-rounded">shield</span>
        Security Settings
      </a>
      <a href="audit.html" class="sub-link" data-page="audit">
        <span class="material-symbols-rounded">fact_check</span>
        Audit Logs
      </a>
      <a href="firewall.html" class="sub-link" data-page="firewall">
        <span class="material-symbols-rounded">local_fire_department</span>
        Firewall
      </a>
      <a href="certificates.html" class="sub-link" data-page="certificates">
        <span class="material-symbols-rounded">verified_user</span>
        Certificates
      </a>
    </div>
  </div>

  <!-- System Sub-Navigation -->
  <div id="sub-system" class="nav-sub">
    <div class="nav-sub-inner">
      <a href="settings.html" class="sub-link" data-page="settings">
        <span class="material-symbols-rounded">tune</span>
        General Settings
      </a>
      <a href="logs.html" class="sub-link" data-page="logs">
        <span class="material-symbols-rounded">description</span>
        System Logs
      </a>
      <a href="ups.html" class="sub-link" data-page="ups">
        <span class="material-symbols-rounded">battery_charging_full</span>
        UPS Management
      </a>
      <a href="reporting.html" class="sub-link" data-page="reporting">
        <span class="material-symbols-rounded">monitoring</span>
        Reporting
      </a>
      <a href="power-management.html" class="sub-link" data-page="power-management">
        <span class="material-symbols-rounded">power_settings_new</span>
        Power Management
      </a>
      <a href="system-settings.html" class="sub-link" data-page="system-settings">
        <span class="material-symbols-rounded">settings_suggest</span>
        System Settings
      </a>
      <a href="system-monitoring.html" class="sub-link" data-page="system-monitoring">
        <span class="material-symbols-rounded">monitor_heart</span>
        Monitoring
      </a>
      <a href="hardware.html" class="sub-link" data-page="hardware">
        <span class="material-symbols-rounded">developer_board</span>
        Hardware
      </a>
      <a href="ipmi.html" class="sub-link" data-page="ipmi">
        <span class="material-symbols-rounded">memory</span>
        IPMI
      </a>
      <a href="removable-media-ui.html" class="sub-link" data-page="removable-media-ui">
        <span class="material-symbols-rounded">usb</span>
        Removable Media
      </a>
    </div>
  </div>
</nav>

<script>
// Navigation behavior
function navigateToSection(section) {
  if (section === 'dashboard') {
    window.location.href = 'index.html';
  }
}

function toggleSubNav(section, button) {
  // Remove active from all nav links
  document.querySelectorAll('.nav-link').forEach(link => {
    link.classList.remove('active');
  });
  
  // Add active to clicked button
  if (button) {
    button.classList.add('active');
  }
  
  // Hide all sub-navs
  document.querySelectorAll('.nav-sub').forEach(sub => {
    sub.classList.remove('active');
  });
  
  // Show selected sub-nav
  const subNav = document.getElementById(`sub-${section}`);
  if (subNav) {
    subNav.classList.add('active');
    document.body.classList.add('has-subnav');
  }
}

// Auto-detect current section and page on load
(function() {
  const currentPage = window.location.pathname.split('/').pop() || 'index.html';
  
  // Page to section mapping
  const pageMap = {
    'acl-manager.html': { section: 'storage', page: 'acl-manager' },
    'audit.html': { section: 'security', page: 'audit' },
    'certificates.html': { section: 'security', page: 'certificates' },
    'cloud-sync.html': { section: 'storage', page: 'cloud-sync' },
    'directory-service.html': { section: 'identity', page: 'directory-service' },
    'docker.html': { section: 'compute', page: 'docker' },
    'files-enhanced.html': { section: 'storage', page: 'files-enhanced' },
    'files.html': { section: 'storage', page: 'files' },
    'firewall.html': { section: 'security', page: 'firewall' },
    'groups.html': { section: 'identity', page: 'groups' },
    'hardware.html': { section: 'system', page: 'hardware' },
    'index.html': { section: 'dashboard', page: null },
    'ipmi.html': { section: 'system', page: 'ipmi' },
    'logs.html': { section: 'system', page: 'logs' },
    'modules.html': { section: 'compute', page: 'modules' },
    'network-dns.html': { section: 'network', page: 'network-dns' },
    'network-interfaces.html': { section: 'network', page: 'network-interfaces' },
    'network-routing.html': { section: 'network', page: 'network-routing' },
    'network.html': { section: 'network', page: 'network' },
    'pools-advanced.html': { section: 'storage', page: 'pools-advanced' },
    'pools.html': { section: 'storage', page: 'pools' },
    'power-management.html': { section: 'system', page: 'power-management' },
    'quotas.html': { section: 'storage', page: 'quotas' },
    'rbac-management.html': { section: 'identity', page: 'rbac-management' },
    'removable-media-ui.html': { section: 'system', page: 'removable-media-ui' },
    'replication.html': { section: 'storage', page: 'replication' },
    'reporting.html': { section: 'system', page: 'reporting' },
    'security.html': { section: 'security', page: 'security' },
    'settings.html': { section: 'system', page: 'settings' },
    'shares.html': { section: 'storage', page: 'shares' },
    'snapshot-scheduler.html': { section: 'storage', page: 'snapshot-scheduler' },
    'system-monitoring.html': { section: 'system', page: 'system-monitoring' },
    'system-settings.html': { section: 'system', page: 'system-settings' },
    'ups.html': { section: 'system', page: 'ups' },
    'users.html': { section: 'identity', page: 'users' },
    'zfs-encryption.html': { section: 'storage', page: 'zfs-encryption' }
  };
  
  const current = pageMap[currentPage];
  if (current) {
    // Activate section button
    const sectionBtn = document.querySelector(`[data-section="${current.section}"]`);
    if (sectionBtn) {
      sectionBtn.classList.add('active');
    }
    
    // Show and activate sub-nav if not dashboard
    if (current.section !== 'dashboard') {
      const subNav = document.getElementById(`sub-${current.section}`);
      if (subNav) {
        subNav.classList.add('active');
        document.body.classList.add('has-subnav');
        
        // Activate current page in sub-nav
        if (current.page) {
          const pageLink = subNav.querySelector(`[data-page="${current.page}"]`);
          if (pageLink) {
            pageLink.classList.add('active');
          }
        }
      }
    }
  }
})();

// Keyboard shortcuts
function showKeyboardHelp() {
  if (window.EnhancedUI) {
    const shortcuts = `Keyboard Shortcuts:

g + d ‚Üí Dashboard
g + s ‚Üí Storage
g + c ‚Üí Compute
g + n ‚Üí Network
g + u ‚Üí Identity
g + e ‚Üí Security
g + y ‚Üí System

r ‚Üí Refresh page
Esc ‚Üí Close modals
? ‚Üí Show this help`;
    EnhancedUI.toast(shortcuts, 'info', 8000);
  }
}

// Enhanced keyboard shortcuts for sections
(function() {
  let keySequence = '';
  let keyTimeout;
  
  document.addEventListener('keydown', (e) => {
    if (['INPUT', 'TEXTAREA', 'SELECT'].includes(e.target.tagName)) return;
    
    keySequence += e.key;
    clearTimeout(keyTimeout);
    
    const shortcuts = {
      'gd': 'index.html',
      'gs': () => toggleSubNav('storage', document.querySelector('[data-section="storage"]')),
      'gc': () => toggleSubNav('compute', document.querySelector('[data-section="compute"]')),
      'gn': () => toggleSubNav('network', document.querySelector('[data-section="network"]')),
      'gu': () => toggleSubNav('identity', document.querySelector('[data-section="identity"]')),
      'ge': () => toggleSubNav('security', document.querySelector('[data-section="security"]')),
      'gy': () => toggleSubNav('system', document.querySelector('[data-section="system"]'))
    };
    
    if (shortcuts[keySequence]) {
      e.preventDefault();
      const action = shortcuts[keySequence];
      if (typeof action === 'function') {
        action();
      } else {
        window.location.href = action;
      }
      keySequence = '';
    } else if (e.key === '?') {
      e.preventDefault();
      showKeyboardHelp();
    }
    
    keyTimeout = setTimeout(() => keySequence = '', 1000);
  });
})();

// Connection status monitoring (integrates with existing connection-monitor.js)
if (window.ConnectionMonitor) {
  window.ConnectionMonitor.on('statusChange', (online) => {
    const status = document.getElementById('navConnectionStatus');
    if (status) {
      if (online) {
        status.classList.remove('offline');
        status.classList.add('online');
        status.innerHTML = '<span class="status-dot"></span><span>Connected</span>';
      } else {
        status.classList.remove('online');
        status.classList.add('offline');
        status.innerHTML = '<span class="status-dot"></span><span>Offline</span>';
      }
    }
  });
}
</script>


  <main class="main">
    <div class="page-header">
      <h1 class="page-title">Dashboard</h1>
      <div class="page-meta">Last updated: 2 minutes ago</div>
    </div>

    <!-- System Stats -->
    <div class="grid grid-4">
      <div class="card stat-card">
        <div class="stat-icon"><span class="material-symbols-rounded">storage</span></div>
        <div class="stat-value">‚Äî</div>
        <div class="stat-label">Storage Used</div>
        <div class="stat-progress"><div class="stat-progress-bar" style="width: 0%;"></div></div>
      </div>
      
      <div class="card stat-card">
        <div class="stat-icon"><span class="material-symbols-rounded">memory</span></div>
        <div class="stat-value">‚Äî</div>
        <div class="stat-label">CPU Usage</div>
        <div class="stat-progress"><div class="stat-progress-bar" style="width: 0%;"></div></div>
      </div>
      
      <div class="card stat-card">
        <div class="stat-icon"><span class="material-symbols-rounded">developer_board</span></div>
        <div class="stat-value">‚Äî</div>
        <div class="stat-label">RAM Used</div>
        <div class="stat-progress"><div class="stat-progress-bar" style="width: 0%;"></div></div>
      </div>
      
      <div class="card stat-card">
        <div class="stat-icon"><span class="material-symbols-rounded">lan</span></div>
        <div class="stat-value">‚Äî</div>
        <div class="stat-label">Network Down</div>
        <div class="stat-progress"><div class="stat-progress-bar" style="width: 0%;"></div></div>
      </div>
    </div>

    <!-- Quick Actions & Storage -->
    <div class="grid grid-2">
      <div class="card">
        <div class="card-header">
          <div class="card-title">Quick Actions</div>
        </div>
        <div style="display: flex; flex-direction: column; gap: 12px;">
          <div class="quick-action" onclick="window.location.href=&#39;files.html&#39;">
            <span class="material-symbols-rounded quick-action-icon">upload</span>
            <div class="quick-action-info">
              <div class="quick-action-title">Upload Files</div>
              <div class="quick-action-desc">Add files to your storage</div>
            </div>
            <span class="material-symbols-rounded" style="color:rgba(255,255,255,0.3);">chevron_right</span>
          </div>
          
          <div class="quick-action" onclick="window.location.href=&#39;docker.html&#39;">
            <span class="material-symbols-rounded quick-action-icon">deployed_code</span>
            <div class="quick-action-info">
              <div class="quick-action-title">Deploy Container</div>
              <div class="quick-action-desc">Start a new Docker container</div>
            </div>
            <span class="material-symbols-rounded" style="color:rgba(255,255,255,0.3);">chevron_right</span>
          </div>
          
          <div class="quick-action" onclick="window.location.href=&#39;pools.html&#39;">
            <span class="material-symbols-rounded quick-action-icon">history</span>
            <div class="quick-action-info">
              <div class="quick-action-title">Take Snapshot</div>
              <div class="quick-action-desc">Create ZFS snapshot</div>
            </div>
            <span class="material-symbols-rounded" style="color:rgba(255,255,255,0.3);">chevron_right</span>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">Storage Pools</div>
          <div class="card-action" onclick="window.location.href=&#39;pools.html&#39;">
            <span class="material-symbols-rounded" style="font-size:16px;">add</span>
          </div>
        </div>
        <!-- Pools loaded dynamically -->
        <div class="pool-list" style="padding:20px;text-align:center;color:rgba(255,255,255,0.5);">Loading pools...</div>
      </div>
    </div>

    <!-- Running Containers & Recent Activity -->
    <div class="grid grid-2">
      <div class="card">
        <div class="card-header">
          <div class="card-title">Running Containers</div>
          <div class="card-action" onclick="window.location.href=&#39;docker.html&#39;">
            <span class="material-symbols-rounded" style="font-size:16px;">deployed_code</span>
          </div>
        </div>
        <!-- Containers loaded dynamically -->
        <div style="padding:20px;text-align:center;color:rgba(255,255,255,0.5);">Loading containers...</div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">Recent Activity</div>
        </div>
        <div class="activity-item">
          <span class="material-symbols-rounded activity-icon">upload</span>
          <div class="activity-content">
            <div class="activity-text">Uploaded <strong>backup-2026-02-02.tar.gz</strong></div>
            <div class="activity-time">2 minutes ago</div>
          </div>
        </div>
        
        <div class="activity-item">
          <span class="material-symbols-rounded activity-icon">deployed_code</span>
          <div class="activity-content">
            <div class="activity-text">Started container <strong>nginx-proxy</strong></div>
            <div class="activity-time">15 minutes ago</div>
          </div>
        </div>
        
        <div class="activity-item">
          <span class="material-symbols-rounded activity-icon">history</span>
          <div class="activity-content">
            <div class="activity-text">Created snapshot <strong>@auto-2026-02-02-06:00</strong></div>
            <div class="activity-time">1 hour ago</div>
          </div>
        </div>
        
        <div class="activity-item">
          <span class="material-symbols-rounded activity-icon">settings_backup_restore</span>
          <div class="activity-content">
            <div class="activity-text">Completed replication to <strong>backup-server</strong></div>
            <div class="activity-time">2 hours ago</div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <button class="fab" onclick="showQuickMenu()"><span class="material-symbols-rounded" style="font-size:28px;">add</span></button>

  <!-- Context Menu -->
  <div class="context-menu" id="contextMenu" style="display: none;">
    <div class="context-menu-item" onclick="window.location.href=&#39;files.html&#39;">
      <span class="material-symbols-rounded">upload</span>
      Upload Files
    </div>
    <div class="context-menu-item" onclick="window.location.href=&#39;docker.html&#39;">
      <span class="material-symbols-rounded">deployed_code</span>
      Deploy Container
    </div>
    <div class="context-menu-item" onclick="window.location.href=&#39;pools.html&#39;">
      <span class="material-symbols-rounded">history</span>
      Take Snapshot
    </div>
    <div class="context-menu-item" onclick="window.location.href=&#39;pools.html&#39;">
      <span class="material-symbols-rounded">add</span>
      Create Pool
    </div>
  </div>

  <script src="/assets/js/m3-ripple.js"></script>
  <script src="/assets/js/ui-components.js"></script>
  <script>
    const ui = new DPlaneUI();
    
    // Load all dashboard data
    async function loadDashboard() {
      try {
        // CRITICAL: Check daemon health FIRST
        const daemonHealthy = await checkDaemonHealth();
        if (!daemonHealthy) {
          showSystemError('System daemon offline', 'Run: sudo systemctl start dplaned');
          return;
        }
        
        // Load system stats
        const statsRes = await csrfFetch('/api/metrics/current');
        const stats = await statsRes.json();
        if (stats.success) updateStats(stats.data);
        
        // Load UPS status
        const upsRes = await csrfFetch('/api/system/ups');
        const ups = await upsRes.json();
        if (ups.success && ups.data) updateUPSStatus(ups.data);
        
        // Load containers
        const containersRes = await csrfFetch('/api/docker/containers');
        const containers = await containersRes.json();
        if (containers.success) updateContainers(containers.containers);
        
        // Load pools
        const poolsRes = await csrfFetch('/api/zfs/pools');
        const pools = await poolsRes.json();
        if (pools.success) updatePools(pools.pools);
        
        // Load recent activity
        const logsRes = await csrfFetch('/api/system/logs?limit=3');
        const logs = await logsRes.json();
        if (logs.success) updateActivity(logs.logs);
        
      } catch (error) {
        console.error('Dashboard load error:', error);
        ui.toast('Failed to load dashboard data', 'error');
      }
    }
    
    async function checkDaemonHealth() {
      try {
        const response = await fetch('http://127.0.0.1:9000/health', { timeout: 2000 });
        if (!response.ok) return false;
        const data = await response.json();
        return data.status === 'ok';
      } catch (e) {
        return false;
      }
    }
    
    function showSystemError(title, message) {
      const errorBanner = document.createElement('div');
      errorBanner.id = 'system-error-banner';
      errorBanner.style.cssText = `
        position: fixed;
        top: 80px;
        left: 0;
        right: 0;
        background: rgba(239, 68, 68, 0.95);
        color: white;
        padding: 20px;
        text-align: center;
        z-index: 10000;
        border-bottom: 3px solid #DC2626;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      `;
      errorBanner.innerHTML = `
        <div style="font-size: 18px; font-weight: 700; margin-bottom: 8px;">${title}</div>
        <div style="font-size: 14px; opacity: 0.9;">${message}</div>
      `;
      document.body.appendChild(errorBanner);
    }
    
    function updateUPSStatus(ups) {
      // Add UPS card if on battery or low battery
      if (ups.status !== 'ONLINE') {
        const upsCard = document.getElementById('ups-alert-card') || createUPSAlertCard();
        upsCard.querySelector('.ups-battery').textContent = ups.battery_charge + '%';
        upsCard.querySelector('.ups-runtime').textContent = ups.battery_runtime;
        upsCard.querySelector('.ups-status').textContent = ups.status;
        
        if (parseInt(ups.battery_charge) < 20) {
          upsCard.style.borderLeftColor = 'var(--error)'; // Red
        } else {
          upsCard.style.borderLeftColor = 'var(--warning)'; // Yellow
        }
      } else {
        // Remove alert card if back online
        const upsCard = document.getElementById('ups-alert-card');
        if (upsCard) upsCard.remove();
      }
    }
    
    function createUPSAlertCard() {
      const card = document.createElement('div');
      card.id = 'ups-alert-card';
      card.className = 'card';
      card.style.cssText = `
        border-left: 4px solid var(--warning);
        background: rgba(245, 158, 11, 0.1);
        margin-bottom: 24px;
      `;
      card.innerHTML = `
        <div class="card-header">
          <div class="card-title">‚ö° UPS Status</div>
        </div>
        <div style="display: grid; gap: 12px;">
          <div style="display: flex; justify-content: space-between;">
            <span style="color: rgba(255,255,255,0.6);">Battery:</span>
            <span class="ups-battery" style="font-weight: 700;">--</span>
          </div>
          <div style="display: flex; justify-content: space-between;">
            <span style="color: rgba(255,255,255,0.6);">Runtime:</span>
            <span class="ups-runtime" style="font-weight: 700;">--</span>
          </div>
          <div style="display: flex; justify-content: space-between;">
            <span style="color: rgba(255,255,255,0.6);">Status:</span>
            <span class="ups-status" style="font-weight: 700; color: var(--warning);">--</span>
          </div>
        </div>
      `;
      
      const grid = document.querySelector('.grid-4');
      grid.insertBefore(card, grid.firstChild);
      return card;
    }
    
    function updateStats(data) {
      // Update CPU gauge
      const cpuPercent = parseFloat(data.cpu) || 0;
      document.querySelector('.gauge-fill').style.width = cpuPercent + '%';
      document.querySelector('.gauge-text').textContent = Math.round(cpuPercent) + '%';
      
      // Update Memory gauge
      const memPercent = parseFloat(data.memory) || 0;
      const memGauges = document.querySelectorAll('.gauge-fill');
      if (memGauges[1]) {
        memGauges[1].style.width = memPercent + '%';
        document.querySelectorAll('.gauge-text')[1].textContent = Math.round(memPercent) + '%';
      }
      
      // Update stats cards
      const statValues = document.querySelectorAll('.stat-value');
      if (statValues[0]) statValues[0].textContent = data.storage || 'N/A';
      if (statValues[1]) statValues[1].textContent = data.containers || '0';
      if (statValues[2]) statValues[2].textContent = data.network || 'N/A';
    }
    
    function updateContainers(containers) {
      const containerList = document.querySelector('.card:has(.card-title:contains("Running Containers"))');
      if (!containerList) return;
      
      // Clear existing (keep header)
      const cardContent = containerList.querySelector('.card-header').parentElement;
      const oldItems = cardContent.querySelectorAll('.container-item');
      oldItems.forEach(item => item.remove());
      
      // Add real containers
      if (!containers || containers.length === 0) {
        cardContent.insertAdjacentHTML('beforeend', '<div style="padding:20px;text-align:center;color:rgba(255,255,255,0.5);">No running containers</div>');
        return;
      }
      
      containers.slice(0, 5).forEach(container => {
        const html = `
          <div class="container-item" onclick="window.location.href='docker.html'">
            <span class="material-symbols-rounded container-icon">deployed_code</span>
            <div style="flex:1;">
              <div class="container-name">${container.name}</div>
              <div class="container-meta">Port ${container.port || 'N/A'} ‚Ä¢ ${container.memory || 'N/A'} RAM ‚Ä¢ ${container.cpu || 'N/A'} CPU</div>
            </div>
            <span style="font-size:12px;color:${container.status === 'running' ? 'var(--success)' : 'var(--error)'};">‚óè</span>
          </div>
        `;
        cardContent.insertAdjacentHTML('beforeend', html);
      });
    }
    
    function updatePools(pools) {
      const poolList = document.querySelector('.pool-list');
      if (!poolList) return;
      
      poolList.innerHTML = '';
      
      if (!pools || pools.length === 0) {
        poolList.innerHTML = '<div style="padding:20px;text-align:center;color:rgba(255,255,255,0.5);">No ZFS pools found</div>';
        return;
      }
      
      pools.forEach(pool => {
        const html = `
          <div class="pool-item" onclick="window.location.href='pools.html'">
            <span class="material-symbols-rounded pool-icon">storage</span>
            <div class="pool-info">
              <div class="pool-name">${pool.name}</div>
              <div class="pool-details">${pool.used} / ${pool.total} ‚Ä¢ ${pool.type}</div>
            </div>
            <div class="pool-status">${pool.health}</div>
          </div>
        `;
        poolList.insertAdjacentHTML('beforeend', html);
      });
    }
    
    function updateActivity(logs) {
      const activityCard = document.querySelector('.card:has(.card-title:contains("Recent Activity"))');
      if (!activityCard) return;
      
      const cardContent = activityCard.querySelector('.card-header').parentElement;
      const oldItems = cardContent.querySelectorAll('.activity-item');
      oldItems.forEach(item => item.remove());
      
      if (!logs || logs.length === 0) {
        cardContent.insertAdjacentHTML('beforeend', '<div style="padding:20px;text-align:center;color:rgba(255,255,255,0.5);">No recent activity</div>');
        return;
      }
      
      logs.forEach(log => {
        const icon = log.type === 'upload' ? 'upload' : 
                     log.type === 'container' ? 'deployed_code' : 'history';
        const html = `
          <div class="activity-item">
            <span class="material-symbols-rounded activity-icon">${icon}</span>
            <div class="activity-content">
              <div class="activity-text">${log.message}</div>
              <div class="activity-time">${log.time}</div>
            </div>
          </div>
        `;
        cardContent.insertAdjacentHTML('beforeend', html);
      });
    }
    
    // Load dashboard on page load
    window.addEventListener('DOMContentLoaded', () => {
      loadDashboard();
      initWebSocketHandlers();
    });
    
    // Initialize WebSocket event handlers
    function initWebSocketHandlers() {
      if (!window.DPlaneRT) {
        console.warn('RealtimeClient not available');
        return;
      }
      
      // Verify data flow after connection
      window.DPlaneRT.on('connected', () => {
        setTimeout(() => {
          if (!window.DPlaneRT.lastState) {
            showSystemError(
              'Real-time monitoring offline',
              'Check dplaneos-monitor service: sudo systemctl status dplaneos-monitor'
            );
          }
        }, 5000);
      });
      
      // State updates (CPU, Memory, etc.)
      window.DPlaneRT.on('stateUpdate', (state) => {
        if (state.cpu) updateStats(state);
        if (state.ups) updateUPSStatus(state.ups);
      });
      
      // Hardware events (disk add/remove)
      window.DPlaneRT.on('hardwareEvent', (event) => {
        const action = event.action === 'add' ? 'connected' : 'removed';
        ui.toast(`üíæ Disk ${action}: ${event.device}`, 'info', 8000);
        
        // Refresh pool list if on Storage page
        if (window.location.pathname.includes('pools.html')) {
          setTimeout(() => location.reload(), 2000);
        }
      });
      
      // Resilver events
      window.DPlaneRT.on('resilver_started', (event) => {
        showResilverCard(event);
        ui.toast(`üîÑ Resilver started: ${event.pool}`, 'info');
      });
      
      window.DPlaneRT.on('resilver_progress', (event) => {
        updateResilverCard(event);
      });
      
      window.DPlaneRT.on('resilver_completed', (event) => {
        hideResilverCard();
        ui.toast(`‚úì Resilver completed: ${event.pool}`, 'success', 10000);
      });
      
      // Disk temperature warnings
      window.DPlaneRT.on('disk_temperature_warning', (event) => {
        ui.toast(
          `‚ö†Ô∏è High disk temperature: ${event.device} at ${event.temp}¬∞C`,
          'warning',
          15000
        );
      });
      
      // Pool health changes
      window.DPlaneRT.on('pool_health_change', (event) => {
        const type = event.health === 'DEGRADED' ? 'error' : 'warning';
        ui.toast(`‚ö†Ô∏è Pool ${event.pool}: ${event.health}`, type, 15000);
        setTimeout(() => loadDashboard(), 1000);
      });
    }
    
    // Resilver Progress Card Management
    function showResilverCard(event) {
      if (document.getElementById('resilver-card')) return;
      
      const card = document.createElement('div');
      card.id = 'resilver-card';
      card.className = 'card';
      card.style.cssText = `
        border-left: 4px solid var(--warning);
        background: rgba(245, 158, 11, 0.05);
        margin-bottom: 24px;
        animation: pulse 2s infinite;
      `;
      card.innerHTML = `
        <div class="card-header">
          <div class="card-title">üîÑ Resilver in Progress</div>
          <span class="material-symbols-rounded" style="color: var(--warning);">sync</span>
        </div>
        <div style="display: grid; gap: 12px;">
          <div style="display: flex; justify-content: space-between;">
            <span style="color: rgba(255,255,255,0.6);">Pool:</span>
            <span style="font-weight: 700;">${event.pool}</span>
          </div>
          <div style="display: flex; justify-content: space-between;">
            <span style="color: rgba(255,255,255,0.6);">Device:</span>
            <span style="font-weight: 700;">${event.device || 'N/A'}</span>
          </div>
          <div style="margin-top: 8px;">
            <div style="height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden;">
              <div id="resilver-progress-bar" style="height: 100%; width: 0%; background: linear-gradient(90deg, var(--primary), var(--primary)); transition: width 1s ease;"></div>
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 8px; font-size: 13px;">
              <span id="resilver-percent" style="color: rgba(255,255,255,0.8);">0%</span>
              <span id="resilver-eta" style="color: rgba(255,255,255,0.6);">Calculating...</span>
            </div>
          </div>
        </div>
      `;
      
      const grid = document.querySelector('.grid-4');
      grid.insertBefore(card, grid.firstChild);
    }
    
    function updateResilverCard(event) {
      const bar = document.getElementById('resilver-progress-bar');
      const percent = document.getElementById('resilver-percent');
      const eta = document.getElementById('resilver-eta');
      
      if (bar && percent && eta) {
        bar.style.width = event.percent + '%';
        percent.textContent = event.percent + '%';
        eta.textContent = 'ETA: ' + (event.eta || 'Unknown');
      }
    }
    
    function hideResilverCard() {
      const card = document.getElementById('resilver-card');
      if (card) {
        card.style.transition = 'opacity 0.5s';
        card.style.opacity = '0';
        setTimeout(() => card.remove(), 500);
      }
    }
    
    // Auto-refresh every 5 seconds
    setInterval(loadDashboard, 5000);

    // Quick menu
    function showQuickMenu() {
      const menu = document.getElementById('contextMenu');
      const fab = document.querySelector('.fab');
      const rect = fab.getBoundingClientRect();
      menu.style.display = 'block';
      menu.style.bottom = '100px';
      menu.style.right = '32px';
      setTimeout(() => menu.style.display = 'none', 3000);
    }

    // Context menu
    document.addEventListener('contextmenu', (e) => {
      if (e.target.closest('.card')) {
        e.preventDefault();
        const menu = document.getElementById('contextMenu');
        menu.style.display = 'block';
        menu.style.left = e.pageX + 'px';
        menu.style.top = e.pageY + 'px';
      }
    });

    document.addEventListener('click', () => {
      document.getElementById('contextMenu').style.display = 'none';
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.key === 'f' && (e.ctrlKey || e.metaKey)) {
        e.preventDefault();
        window.location.href = 'files.html';
      } else if (e.key === 'd' && (e.ctrlKey || e.metaKey)) {
        e.preventDefault();
        window.location.href = 'docker.html';
      }
    });
  </script>


<script src="/assets/js/ui-components.js"></script>
  <script src="/assets/js/realtime-client.js"></script>
</body></html>
