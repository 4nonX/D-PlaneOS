<!DOCTYPE html>
<html lang="en">
<head><style>html{background:#0a0a0a}</style><style></style>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IPMI Hardware Monitor - D-PlaneOS</title>
  <link rel="stylesheet" href="/assets/css/design-tokens.css">
<link rel="stylesheet" href="/assets/css/m3-tokens.css">
<link rel="stylesheet" href="/assets/css/m3-components.css">
<link rel="stylesheet" href="/assets/css/m3-icons.css">
  <link rel="stylesheet" href="/assets/css/enhanced-ui.css">
<link rel="stylesheet" href="/assets/css/m3-animations.css">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif; background: #0a0a0a; color: #fff; overflow-x: hidden; }


.logo { font-size: 20px; font-weight: 800; color: var(--primary); letter-spacing: -0.5px; cursor: pointer; }


.nav-link:hover, 
.main { max-width: 1600px; margin: 140px auto 60px; padding: 0 40px; }
.page-header { margin-bottom: 48px; }
.page-title { font-size: 32px; font-weight: 700; letter-spacing: -1.5px; margin-bottom: 12px; }
.page-subtitle { font-size: 18px; color: rgba(255,255,255,0.6); }
.pool-card { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: var(--radius-xl); padding: 32px; margin-bottom: 24px; border-left: 4px solid var(--primary); }
.pool-header { display: flex; align-items: center; gap: 20px; margin-bottom: 20px; }
.pool-icon { font-size: 32px; color: var(--primary); }
.pool-info { flex: 1; }
.pool-name { font-size: 28px; font-weight: 700; margin-bottom: 6px; }
.pool-details { font-size: 15px; color: rgba(255,255,255,0.6); }
.capacity-bar { height: 12px; background: rgba(255,255,255,0.05); border-radius: 24px; overflow: hidden; margin: 20px 0; }
.capacity-fill { height: 100%; background: linear-gradient(90deg, var(--primary), var(--primary)); border-radius: 24px; transition: width 0.5s; }
/* Badge styles are in m3-components.css */
.icon-btn { width: 40px; height: 40px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: rgba(255,255,255,0.8); cursor: pointer; transition: all 0.3s; border: none; }
.icon-btn:hover { background: rgba(255,255,255,0.1); color: #fff; }
.btn { background: rgba(255,255,255,0.1); color: #fff; padding: 12px 24px; border-radius: 10px; font-weight: 500; font-size: 14px; border: none; cursor: pointer; transition: all 0.3s; }
.btn:hover { background: rgba(255,255,255,0.15); }
.btn-primary { background: linear-gradient(135deg, var(--primary) 0%, var(--primary) 100%); }
.btn-primary:hover { box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4); }
.fab { position: fixed; bottom: 32px; right: 32px; width: 64px; height: 64px; background: linear-gradient(135deg, var(--primary) 0%, var(--primary) 100%); border-radius: 20px; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 32px rgba(102, 126, 234, 0.4); cursor: pointer; transition: all 0.3s; border: none; color: #fff; }
.fab:hover { transform: translateY(-4px); box-shadow: 0 12px 48px rgba(102, 126, 234, 0.6); }
</style>
<style type="text/css" id="operaUserStyle"></style><link rel="stylesheet" href="/assets/css/ui-components.css">
<script src="/assets/js/core.js"></script>
<script src="/assets/js/nav-flyout.js"></script>
<script src="/assets/js/hybrid-router.js"></script>
  <script src="/assets/js/enhanced-ui.js"></script>
  <script src="/assets/js/connection-monitor.js"></script>
  <script src="/assets/js/keyboard-shortcuts.js"></script>
  <script src="/assets/js/form-validator.js"></script>
  <link rel="stylesheet" href="/assets/css/material-symbols-local.css">
  <link rel="stylesheet" href="/assets/css/ui-consistency.css">
  <link rel="stylesheet" href="/assets/css/ui-polish.css">
  <script src="/assets/js/daemon-api.js"></script>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif; background: var(--bg); color: var(--text); overflow-x: hidden; }

.main { max-width: 1600px; margin: 140px auto 60px; padding: 0 40px; }
.page-header { margin-bottom: 48px; }
.page-title { font-size: 32px; font-weight: 700; letter-spacing: -1.5px; margin-bottom: 12px; display: flex; align-items: center; gap: 16px; }
.page-subtitle { font-size: 18px; color: var(--text-dim); }

.status-banner { background: var(--surface-variant); border: 1px solid var(--border); border-radius: 16px; padding: 24px; margin-bottom: 32px; display: flex; align-items: center; gap: 20px; }
.status-banner.online { background: var(--success-bg); border-color: var(--success-border); }
.status-banner.offline { background: var(--error-bg); border-color: var(--error-border); }
.status-icon { font-size: 48px; }
.status-icon.online { color: var(--success); }
.status-icon.offline { color: var(--error); }
.status-content { flex: 1; }
.status-title { font-size: 20px; font-weight: 700; margin-bottom: 4px; }
.status-message { font-size: 14px; color: var(--text-dim); }
.status-refresh { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 12px 20px; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.2s; }
.status-refresh:hover { background: var(--surface-hover); }

.section { margin-bottom: 48px; }
.section-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px; }
.section-title { font-size: 20px; font-weight: 700; }
.section-stats { display: flex; gap: 16px; }
.stat-badge { background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 8px 16px; font-size: 13px; display: flex; align-items: center; gap: 8px; }
.stat-badge.ok { background: var(--success-bg); border-color: var(--success-border); color: var(--success); }
.stat-badge.warning { background: var(--warning-bg); border-color: var(--warning-border); color: var(--warning); }
.stat-badge.critical { background: var(--error-bg); border-color: var(--error-border); color: var(--error); }
.stat-badge.disabled { color: var(--text-dim); }

.sensor-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px; }
.sensor-card { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 20px; transition: all 0.2s; }
.sensor-card:hover { background: var(--surface-hover); transform: translateY(-2px); }
.sensor-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
.sensor-category { font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; color: var(--primary); }
.sensor-status { width: 12px; height: 12px; border-radius: 50%; }
.sensor-status.ok { background: var(--success); }
.sensor-status.warning { background: var(--warning); }
.sensor-status.critical { background: var(--error); animation: pulse 2s infinite; }
.sensor-status.disabled { background: var(--text-dimmer); }
@keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

.sensor-name { font-size: 16px; font-weight: 600; margin-bottom: 8px; }
.sensor-value { font-size: 32px; font-weight: 700; color: var(--primary); margin-bottom: 4px; }
.sensor-units { font-size: 14px; color: var(--text-dim); }

.event-log { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 24px; }
.event-list { max-height: 500px; overflow-y: auto; }
.event-item { border-bottom: 1px solid var(--border-subtle); padding: 16px 0; display: flex; gap: 16px; }
.event-item:last-child { border-bottom: none; }
.event-severity-icon { font-size: 24px; flex-shrink: 0; }
.event-severity-icon.critical { color: var(--error); }
.event-severity-icon.error { color: var(--error); }
.event-severity-icon.warning { color: var(--warning); }
.event-severity-icon.info { color: var(--info); }
.event-content { flex: 1; }
.event-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px; }
.event-sensor { font-size: 14px; font-weight: 600; }
.event-time { font-size: 12px; color: var(--text-dim); }
.event-message { font-size: 13px; color: var(--text-dim); }

.power-panel { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 24px; }
.power-status { display: flex; align-items: center; gap: 16px; margin-bottom: 24px; padding: 16px; background: var(--surface-variant); border-radius: 12px; }
.power-status-icon { font-size: 48px; color: var(--success); }
.power-status-text { flex: 1; }
.power-status-label { font-size: 14px; color: var(--text-dim); margin-bottom: 4px; }
.power-status-value { font-size: 24px; font-weight: 700; }
.power-controls { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; }
.power-btn { background: var(--surface-variant); border: 1px solid var(--border); border-radius: 12px; padding: 16px; cursor: pointer; transition: all 0.2s; display: flex; flex-direction: column; align-items: center; gap: 8px; text-align: center; }
.power-btn:hover { background: var(--surface-hover); transform: translateY(-2px); }
.power-btn:disabled { opacity: 0.5; cursor: not-allowed; }
.power-btn.destructive { border-color: var(--error-border); }
.power-btn.destructive:hover { background: var(--error-bg); }
.power-btn-icon { font-size: 32px; }
.power-btn-label { font-size: 14px; font-weight: 600; }

.modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 1000; align-items: center; justify-content: center; }
.modal.active { display: flex; }
.modal-content { background: var(--bg-elevated); border: 1px solid var(--border); border-radius: 20px; padding: 32px; max-width: 500px; width: 90%; }
.modal-header { margin-bottom: 24px; }
.modal-title { font-size: 24px; font-weight: 700; margin-bottom: 8px; }
.modal-message { font-size: 16px; color: var(--text-dim); }
.modal-actions { display: flex; gap: 12px; justify-content: flex-end; margin-top: 32px; }
.btn { padding: 12px 24px; border-radius: 12px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; border: none; }
.btn-secondary { background: var(--surface); border: 1px solid var(--border); color: var(--text); }
.btn-secondary:hover { background: var(--surface-hover); }
.btn-primary { background: var(--primary); color: var(--text-on-primary); }
.btn-primary:hover { background: var(--primary-hover); }
.btn-danger { background: var(--error); color: white; }
.btn-danger:hover { background: #ff3838; }

.empty-state { text-align: center; padding: 60px 20px; color: var(--text-dim); }
.empty-state-icon { font-size: 64px; margin-bottom: 16px; opacity: 0.3; }
.empty-state-message { font-size: 16px; }

.loading { display: none; text-align: center; padding: 40px; }
.loading.active { display: block; }
.spinner { display: inline-block; width: 40px; height: 40px; border: 4px solid var(--border); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }
@keyframes spin { to { transform: rotate(360deg); } }

.toast { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%); background: var(--bg-elevated); border: 1px solid var(--border); border-radius: 12px; padding: 16px 24px; display: flex; align-items: center; gap: 12px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5); z-index: 1001; opacity: 0; transition: opacity 0.3s; pointer-events: none; }
.toast.show { opacity: 1; pointer-events: auto; }
.toast.success { border-color: var(--success-border); background: var(--success-bg); }
.toast.error { border-color: var(--error-border); background: var(--error-bg); }
.toast-icon { font-size: 24px; }
.toast-message { font-size: 14px; font-weight: 600; }

.admin-only { opacity: 0.5; pointer-events: none; }
</style>
</head>
<body>

<nav class="nav-container">
  <div class="nav-main">
    <div style="display: flex; align-items: center; gap: 16px;">
      <div class="logo">
        D-PlaneOS
        <span class="version-badge">v2.1.0</span>
      </div>
    </div>
    
    <div class="nav-links">
      <button class="nav-link" onclick="navigateToSection('dashboard')" data-section="dashboard">
        Dashboard
      </button>
      <button class="nav-link" onclick="toggleSubNav('storage', this)" data-section="storage">
        Storage
      </button>
      <button class="nav-link" onclick="toggleSubNav('compute', this)" data-section="compute">
        Compute
      </button>
      <button class="nav-link" onclick="toggleSubNav('network', this)" data-section="network">
        Network
      </button>
      <button class="nav-link" onclick="toggleSubNav('identity', this)" data-section="identity">
        Identity
      </button>
      <button class="nav-link" onclick="toggleSubNav('security', this)" data-section="security">
        Security
      </button>
      <button class="nav-link" onclick="toggleSubNav('system', this)" data-section="system">
        System
      </button>
    </div>
    
    <div class="nav-actions">
      <button class="nav-action-btn" onclick="showKeyboardHelp()" title="Keyboard Shortcuts (?)">
        <span class="material-symbols-rounded">keyboard</span>
      </button>
      <div class="connection-status online" id="navConnectionStatus">
        <span class="status-dot"></span>
        <span>Connected</span>
      </div>
    </div>
  </div>

  <!-- Storage Sub-Navigation -->
  <div id="sub-storage" class="nav-sub">
    <div class="nav-sub-inner">
      <a href="pools.html" class="sub-link" data-page="pools">
        <span class="material-symbols-rounded">database</span>
        ZFS Pools
      </a>
      <a href="pools-advanced.html" class="sub-link" data-page="pools-advanced">
        <span class="material-symbols-rounded">photo_camera</span>
        Snapshots
      </a>
      <a href="shares.html" class="sub-link" data-page="shares">
        <span class="material-symbols-rounded">folder_shared</span>
        Shares
      </a>
      <a href="replication.html" class="sub-link" data-page="replication">
        <span class="material-symbols-rounded">sync</span>
        Replication
      </a>
      <a href="files.html" class="sub-link" data-page="files">
        <span class="material-symbols-rounded">folder_open</span>
        File Explorer
      </a>
      <a href="quotas.html" class="sub-link" data-page="quotas">
        <span class="material-symbols-rounded">pie_chart</span>
        Quotas
      </a>
      <a href="snapshot-scheduler.html" class="sub-link" data-page="snapshot-scheduler">
        <span class="material-symbols-rounded">schedule</span>
        Snapshot Scheduler
      </a>
      <a href="acl-manager.html" class="sub-link" data-page="acl-manager">
        <span class="material-symbols-rounded">admin_panel_settings</span>
        ACL Manager
      </a>
      <a href="zfs-encryption.html" class="sub-link" data-page="zfs-encryption">
        <span class="material-symbols-rounded">enhanced_encryption</span>
        Encryption
      </a>
      <a href="files-enhanced.html" class="sub-link" data-page="files-enhanced">
        <span class="material-symbols-rounded">upload_file</span>
        File Upload
      </a>
      <a href="cloud-sync.html" class="sub-link" data-page="cloud-sync">
        <span class="material-symbols-rounded">cloud_sync</span>
        Cloud Sync
      </a>
    </div>
  </div>

  <!-- Compute Sub-Navigation -->
  <div id="sub-compute" class="nav-sub">
    <div class="nav-sub-inner">
      <a href="docker.html" class="sub-link" data-page="docker">
        <span class="material-symbols-rounded">dns</span>
        Docker Containers
      </a>
      <a href="git-sync.html" class="sub-link" data-page="git-sync">
        <span class="material-symbols-rounded">sync</span>
        Git Sync
      </a>
      <a href="modules.html" class="sub-link" data-page="modules">
        <span class="material-symbols-rounded">extension</span>
        App Modules
      </a>
    </div>
  </div>

  <!-- Network Sub-Navigation -->
  <div id="sub-network" class="nav-sub">
    <div class="nav-sub-inner">
      <a href="network.html" class="sub-link" data-page="network">
        <span class="material-symbols-rounded">lan</span>
        Network Settings
      </a>
      <a href="network-interfaces.html" class="sub-link" data-page="network-interfaces">
        <span class="material-symbols-rounded">settings_ethernet</span>
        Interfaces
      </a>
      <a href="network-dns.html" class="sub-link" data-page="network-dns">
        <span class="material-symbols-rounded">dns</span>
        DNS
      </a>
      <a href="network-routing.html" class="sub-link" data-page="network-routing">
        <span class="material-symbols-rounded">route</span>
        Routing
      </a>
    </div>
  </div>

  <!-- Identity Sub-Navigation -->
  <div id="sub-identity" class="nav-sub">
    <div class="nav-sub-inner">
      <a href="users.html" class="sub-link" data-page="users">
        <span class="material-symbols-rounded">person</span>
        Users
      </a>
      <a href="groups.html" class="sub-link" data-page="groups">
        <span class="material-symbols-rounded">group</span>
        Groups
      </a>
      <a href="directory-service.html" class="sub-link" data-page="directory-service">
        <span class="material-symbols-rounded">domain</span>
        Directory Service
      </a>
      <a href="rbac-management.html" class="sub-link" data-page="rbac-management">
        <span class="material-symbols-rounded">admin_panel_settings</span>
        Roles & Permissions
      </a>
    </div>
  </div>

  <!-- Security Sub-Navigation -->
  <div id="sub-security" class="nav-sub">
    <div class="nav-sub-inner">
      <a href="security.html" class="sub-link" data-page="security">
        <span class="material-symbols-rounded">shield</span>
        Security Settings
      </a>
      <a href="audit.html" class="sub-link" data-page="audit">
        <span class="material-symbols-rounded">fact_check</span>
        Audit Logs
      </a>
      <a href="firewall.html" class="sub-link" data-page="firewall">
        <span class="material-symbols-rounded">local_fire_department</span>
        Firewall
      </a>
      <a href="certificates.html" class="sub-link" data-page="certificates">
        <span class="material-symbols-rounded">verified_user</span>
        Certificates
      </a>
    </div>
  </div>

  <!-- System Sub-Navigation -->
  <div id="sub-system" class="nav-sub">
    <div class="nav-sub-inner">
      <a href="settings.html" class="sub-link" data-page="settings">
        <span class="material-symbols-rounded">tune</span>
        General Settings
      </a>
      <a href="logs.html" class="sub-link" data-page="logs">
        <span class="material-symbols-rounded">description</span>
        System Logs
      </a>
      <a href="ups.html" class="sub-link" data-page="ups">
        <span class="material-symbols-rounded">battery_charging_full</span>
        UPS Management
      </a>
      <a href="reporting.html" class="sub-link" data-page="reporting">
        <span class="material-symbols-rounded">monitoring</span>
        Reporting
      </a>
      <a href="power-management.html" class="sub-link" data-page="power-management">
        <span class="material-symbols-rounded">power_settings_new</span>
        Power Management
      </a>
      <a href="system-settings.html" class="sub-link" data-page="system-settings">
        <span class="material-symbols-rounded">settings_suggest</span>
        System Settings
      </a>
      <a href="system-monitoring.html" class="sub-link" data-page="system-monitoring">
        <span class="material-symbols-rounded">monitor_heart</span>
        Monitoring
      </a>
      <a href="hardware.html" class="sub-link" data-page="hardware">
        <span class="material-symbols-rounded">developer_board</span>
        Hardware
      </a>
      <a href="ipmi.html" class="sub-link" data-page="ipmi">
        <span class="material-symbols-rounded">memory</span>
        IPMI
      </a>
      <a href="removable-media-ui.html" class="sub-link" data-page="removable-media-ui">
        <span class="material-symbols-rounded">usb</span>
        Removable Media
      </a>
    </div>
  </div>
</nav>

<div class="main">
  <div class="page-header">
    <div class="page-title">
      <span class="material-symbols-rounded" style="font-size: 40px;">memory</span>
      IPMI Hardware Monitor
    </div>
    <div class="page-subtitle">Real-time hardware health monitoring via IPMI</div>
  </div>

  <!-- Status Banner -->
  <div id="statusBanner" class="status-banner">
    <span class="material-symbols-rounded status-icon">hourglass_empty</span>
    <div class="status-content">
      <div class="status-title">Checking IPMI status...</div>
      <div class="status-message">Connecting to BMC</div>
    </div>
    <button class="status-refresh" onclick="checkIPMIStatus()">
      <span class="material-symbols-rounded">refresh</span>
      Refresh
    </button>
  </div>

  <!-- Sensor Monitoring -->
  <div class="section">
    <div class="section-header">
      <div class="section-title">Hardware Sensors</div>
      <div class="section-stats" id="sensorStats">
        <div class="stat-badge"><span>‚óè</span> <span id="statTotal">0</span> Total</div>
        <div class="stat-badge ok"><span>‚óè</span> <span id="statOk">0</span> OK</div>
        <div class="stat-badge warning"><span>‚óè</span> <span id="statWarning">0</span> Warning</div>
        <div class="stat-badge critical"><span>‚óè</span> <span id="statCritical">0</span> Critical</div>
      </div>
    </div>
    
    <div class="loading active" id="sensorsLoading">
      <div class="spinner"></div>
    </div>

    <div id="temperatureSensors" style="display: none;">
      <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: var(--text-dim);">üå°Ô∏è Temperature</h3>
      <div class="sensor-grid" id="tempGrid"></div>
    </div>

    <div id="fanSensors" style="display: none; margin-top: 32px;">
      <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: var(--text-dim);">üí® Fans</h3>
      <div class="sensor-grid" id="fanGrid"></div>
    </div>

    <div id="voltageSensors" style="display: none; margin-top: 32px;">
      <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: var(--text-dim);">‚ö° Voltage</h3>
      <div class="sensor-grid" id="voltageGrid"></div>
    </div>

    <div id="powerSensors" style="display: none; margin-top: 32px;">
      <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: var(--text-dim);">üîå Power</h3>
      <div class="sensor-grid" id="powerGrid"></div>
    </div>

    <div id="currentSensors" style="display: none; margin-top: 32px;">
      <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: var(--text-dim);">‚ö° Current</h3>
      <div class="sensor-grid" id="currentGrid"></div>
    </div>

    <div class="empty-state" id="sensorsEmpty" style="display: none;">
      <div class="material-symbols-rounded empty-state-icon">sensors_off</div>
      <div class="empty-state-message">No sensor data available</div>
    </div>
  </div>

  <!-- System Event Log -->
  <div class="section">
    <div class="section-header">
      <div class="section-title">System Event Log (SEL)</div>
      <button class="status-refresh" onclick="loadEvents()">
        <span class="material-symbols-rounded">refresh</span>
        Refresh
      </button>
    </div>
    
    <div class="event-log">
      <div class="loading active" id="eventsLoading">
        <div class="spinner"></div>
      </div>
      <div class="event-list" id="eventList" style="display: none;"></div>
      <div class="empty-state" id="eventsEmpty" style="display: none;">
        <div class="material-symbols-rounded empty-state-icon">event_note</div>
        <div class="empty-state-message">No events logged</div>
      </div>
    </div>
  </div>

  <!-- Power Control -->
  <div class="section" id="powerSection">
    <div class="section-header">
      <div class="section-title">Power Control</div>
      <div style="font-size: 12px; color: var(--warning); display: flex; align-items: center; gap: 8px;">
        <span class="material-symbols-rounded" style="font-size: 16px;">lock</span>
        Admin Only
      </div>
    </div>
    
    <div class="power-panel">
      <div class="power-status">
        <span class="material-symbols-rounded power-status-icon">power</span>
        <div class="power-status-text">
          <div class="power-status-label">Current Power State</div>
          <div class="power-status-value" id="powerState">Unknown</div>
        </div>
      </div>
      
      <div class="power-controls">
        <button class="power-btn" onclick="doPowerOperation('status')">
          <span class="material-symbols-rounded power-btn-icon">info</span>
          <span class="power-btn-label">Check Status</span>
        </button>
        <button class="power-btn" onclick="confirmPowerOperation('on')">
          <span class="material-symbols-rounded power-btn-icon">power_settings_new</span>
          <span class="power-btn-label">Power On</span>
        </button>
        <button class="power-btn destructive" onclick="confirmPowerOperation('off')">
          <span class="material-symbols-rounded power-btn-icon">power_off</span>
          <span class="power-btn-label">Power Off</span>
        </button>
        <button class="power-btn destructive" onclick="confirmPowerOperation('reset')">
          <span class="material-symbols-rounded power-btn-icon">restart_alt</span>
          <span class="power-btn-label">Reset</span>
        </button>
        <button class="power-btn destructive" onclick="confirmPowerOperation('cycle')">
          <span class="material-symbols-rounded power-btn-icon">sync</span>
          <span class="power-btn-label">Power Cycle</span>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Confirmation Modal -->
<div id="confirmModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title" id="modalTitle">Confirm Operation</div>
      <div class="modal-message" id="modalMessage">Are you sure you want to perform this operation?</div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
      <button class="btn btn-danger" id="confirmBtn" onclick="executePowerOperation()">Confirm</button>
    </div>
  </div>
</div>

<!-- Toast Notification -->
<div id="toast" class="toast">
  <span class="material-symbols-rounded toast-icon" id="toastIcon">check_circle</span>
  <span class="toast-message" id="toastMessage">Operation successful</span>
</div>

<script>
// Navigation behavior
function navigateToSection(section) {
  if (section === 'dashboard') {
    window.location.href = 'index.html';
  }
}

function toggleSubNav(section, button) {
  // Remove active from all nav links
  document.querySelectorAll('.nav-link').forEach(link => {
    link.classList.remove('active');
  });
  
  // Add active to clicked button
  if (button) {
    button.classList.add('active');
  }
  
  // Hide all sub-navs
  document.querySelectorAll('.nav-sub').forEach(sub => {
    sub.classList.remove('active');
  });
  
  // Show selected sub-nav
  const subNav = document.getElementById(`sub-${section}`);
  if (subNav) {
    subNav.classList.add('active');
    document.body.classList.add('has-subnav');
  }
}

// Auto-detect current section and page on load
(function() {
  const currentPage = window.location.pathname.split('/').pop() || 'index.html';
  
  // Page to section mapping
  const pageMap = {
    'acl-manager.html': { section: 'storage', page: 'acl-manager' },
    'audit.html': { section: 'security', page: 'audit' },
    'certificates.html': { section: 'security', page: 'certificates' },
    'cloud-sync.html': { section: 'storage', page: 'cloud-sync' },
    'directory-service.html': { section: 'identity', page: 'directory-service' },
    'docker.html': { section: 'compute', page: 'docker' },
    'files-enhanced.html': { section: 'storage', page: 'files-enhanced' },
    'files.html': { section: 'storage', page: 'files' },
    'firewall.html': { section: 'security', page: 'firewall' },
    'groups.html': { section: 'identity', page: 'groups' },
    'hardware.html': { section: 'system', page: 'hardware' },
    'index.html': { section: 'dashboard', page: null },
    'ipmi.html': { section: 'system', page: 'ipmi' },
    'logs.html': { section: 'system', page: 'logs' },
    'modules.html': { section: 'compute', page: 'modules' },
    'network-dns.html': { section: 'network', page: 'network-dns' },
    'network-interfaces.html': { section: 'network', page: 'network-interfaces' },
    'network-routing.html': { section: 'network', page: 'network-routing' },
    'network.html': { section: 'network', page: 'network' },
    'pools-advanced.html': { section: 'storage', page: 'pools-advanced' },
    'pools.html': { section: 'storage', page: 'pools' },
    'power-management.html': { section: 'system', page: 'power-management' },
    'quotas.html': { section: 'storage', page: 'quotas' },
    'rbac-management.html': { section: 'identity', page: 'rbac-management' },
    'removable-media-ui.html': { section: 'system', page: 'removable-media-ui' },
    'replication.html': { section: 'storage', page: 'replication' },
    'reporting.html': { section: 'system', page: 'reporting' },
    'security.html': { section: 'security', page: 'security' },
    'settings.html': { section: 'system', page: 'settings' },
    'shares.html': { section: 'storage', page: 'shares' },
    'snapshot-scheduler.html': { section: 'storage', page: 'snapshot-scheduler' },
    'system-monitoring.html': { section: 'system', page: 'system-monitoring' },
    'system-settings.html': { section: 'system', page: 'system-settings' },
    'ups.html': { section: 'system', page: 'ups' },
    'users.html': { section: 'identity', page: 'users' },
    'zfs-encryption.html': { section: 'storage', page: 'zfs-encryption' }
  };
  
  const current = pageMap[currentPage];
  if (current) {
    // Activate section button
    const sectionBtn = document.querySelector(`[data-section="${current.section}"]`);
    if (sectionBtn) {
      sectionBtn.classList.add('active');
    }
    
    // Show and activate sub-nav if not dashboard
    if (current.section !== 'dashboard') {
      const subNav = document.getElementById(`sub-${current.section}`);
      if (subNav) {
        subNav.classList.add('active');
        document.body.classList.add('has-subnav');
        
        // Activate current page in sub-nav
        if (current.page) {
          const pageLink = subNav.querySelector(`[data-page="${current.page}"]`);
          if (pageLink) {
            pageLink.classList.add('active');
          }
        }
      }
    }
  }
})();

// Keyboard shortcuts
function showKeyboardHelp() {
  if (window.EnhancedUI) {
    const shortcuts = `Keyboard Shortcuts:

g + d ‚Üí Dashboard
g + s ‚Üí Storage
g + c ‚Üí Compute
g + n ‚Üí Network
g + u ‚Üí Identity
g + e ‚Üí Security
g + y ‚Üí System

r ‚Üí Refresh page
Esc ‚Üí Close modals
? ‚Üí Show this help`;
    EnhancedUI.toast(shortcuts, 'info', 8000);
  }
}

// Enhanced keyboard shortcuts for sections
(function() {
  let keySequence = '';
  let keyTimeout;
  
  document.addEventListener('keydown', (e) => {
    if (['INPUT', 'TEXTAREA', 'SELECT'].includes(e.target.tagName)) return;
    
    keySequence += e.key;
    clearTimeout(keyTimeout);
    
    const shortcuts = {
      'gd': 'index.html',
      'gs': () => toggleSubNav('storage', document.querySelector('[data-section="storage"]')),
      'gc': () => toggleSubNav('compute', document.querySelector('[data-section="compute"]')),
      'gn': () => toggleSubNav('network', document.querySelector('[data-section="network"]')),
      'gu': () => toggleSubNav('identity', document.querySelector('[data-section="identity"]')),
      'ge': () => toggleSubNav('security', document.querySelector('[data-section="security"]')),
      'gy': () => toggleSubNav('system', document.querySelector('[data-section="system"]'))
    };
    
    if (shortcuts[keySequence]) {
      e.preventDefault();
      const action = shortcuts[keySequence];
      if (typeof action === 'function') {
        action();
      } else {
        window.location.href = action;
      }
      keySequence = '';
    } else if (e.key === '?') {
      e.preventDefault();
      showKeyboardHelp();
    }
    
    keyTimeout = setTimeout(() => keySequence = '', 1000);
  });
})();

// Connection status monitoring (integrates with existing connection-monitor.js)
if (window.ConnectionMonitor) {
  window.ConnectionMonitor.on('statusChange', (online) => {
    const status = document.getElementById('navConnectionStatus');
    if (status) {
      if (online) {
        status.classList.remove('offline');
        status.classList.add('online');
        status.innerHTML = '<span class="status-dot"></span><span>Connected</span>';
      } else {
        status.classList.remove('online');
        status.classList.add('offline');
        status.innerHTML = '<span class="status-dot"></span><span>Offline</span>';
      }
    }
  });
}
</script>

<script>
// Configuration
const API_BASE = '/api/metrics/current';
let currentOperation = null;
let refreshInterval = null;

// CSRF Token
function getCSRFToken() {
  const match = document.cookie.match(/csrf_token=([^;]+)/);
  return match ? match[1] : '';
}

// Toast notifications
function showToast(message, type = 'success') {
  const toast = document.getElementById('toast');
  const icon = document.getElementById('toastIcon');
  const msg = document.getElementById('toastMessage');
  
  toast.className = 'toast show ' + type;
  icon.textContent = type === 'success' ? 'check_circle' : 'error';
  msg.textContent = message;
  
  setTimeout(() => {
    toast.classList.remove('show');
  }, 3000);
}

// Check IPMI status
async function checkIPMIStatus() {
  try {
    const response = await fetch(`${API_BASE}?action=status`);
    const data = await response.json();
    
    const banner = document.getElementById('statusBanner');
    const icon = banner.querySelector('.status-icon');
    const title = banner.querySelector('.status-title');
    const message = banner.querySelector('.status-message');
    
    if (data.success && data.ipmi_available) {
      banner.className = 'status-banner online';
      icon.textContent = 'check_circle';
      icon.className = 'material-symbols-rounded status-icon online';
      title.textContent = 'IPMI Available';
      message.textContent = data.message;
      
      // Load sensors and events
      loadSensors();
      loadEvents();
      
      // Start auto-refresh
      if (!refreshInterval) {
        refreshInterval = setInterval(() => {
          loadSensors();
          loadEvents();
        }, 5000);
      }
    } else {
      banner.className = 'status-banner offline';
      icon.textContent = 'error';
      icon.className = 'material-symbols-rounded status-icon offline';
      title.textContent = 'IPMI Not Available';
      message.textContent = data.message || 'IPMI/BMC not accessible';
      
      document.getElementById('sensorsLoading').classList.remove('active');
      document.getElementById('sensorsEmpty').style.display = 'block';
      document.getElementById('eventsLoading').classList.remove('active');
      document.getElementById('eventsEmpty').style.display = 'block';
    }
  } catch (error) {
    console.error('Failed to check IPMI status:', error);
    showToast('Failed to check IPMI status', 'error');
  }
}

// Load sensors
async function loadSensors() {
  try {
    const response = await fetch(`${API_BASE}?action=sensors`);
    const data = await response.json();
    
    document.getElementById('sensorsLoading').classList.remove('active');
    
    if (data.success && data.sensors) {
      // Update statistics
      document.getElementById('statTotal').textContent = data.statistics.total;
      document.getElementById('statOk').textContent = data.statistics.ok;
      document.getElementById('statWarning').textContent = data.statistics.warning;
      document.getElementById('statCritical').textContent = data.statistics.critical;
      
      // Render sensor categories
      renderSensorCategory('temperature', data.sensors.temperature, 'tempGrid', 'temperatureSensors');
      renderSensorCategory('fan', data.sensors.fan, 'fanGrid', 'fanSensors');
      renderSensorCategory('voltage', data.sensors.voltage, 'voltageGrid', 'voltageSensors');
      renderSensorCategory('power', data.sensors.power, 'powerGrid', 'powerSensors');
      renderSensorCategory('current', data.sensors.current, 'currentGrid', 'currentSensors');
    } else {
      document.getElementById('sensorsEmpty').style.display = 'block';
    }
  } catch (error) {
    console.error('Failed to load sensors:', error);
    document.getElementById('sensorsLoading').classList.remove('active');
    document.getElementById('sensorsEmpty').style.display = 'block';
  }
}

// Render sensor category
function renderSensorCategory(category, sensors, gridId, containerId) {
  const grid = document.getElementById(gridId);
  const container = document.getElementById(containerId);
  
  if (!sensors || sensors.length === 0) {
    container.style.display = 'none';
    return;
  }
  
  container.style.display = 'block';
  grid.innerHTML = '';
  
  sensors.forEach(sensor => {
    const card = document.createElement('div');
    card.className = 'sensor-card';
    card.innerHTML = `
      <div class="sensor-header">
        <div class="sensor-category">${category}</div>
        <div class="sensor-status ${sensor.health}"></div>
      </div>
      <div class="sensor-name">${sensor.name}</div>
      <div class="sensor-value">${sensor.numeric_value !== null ? sensor.numeric_value : sensor.value}</div>
      <div class="sensor-units">${sensor.units || ''}</div>
    `;
    grid.appendChild(card);
  });
}

// Load events
async function loadEvents() {
  try {
    const response = await fetch(`${API_BASE}?action=events&limit=50`);
    const data = await response.json();
    
    document.getElementById('eventsLoading').classList.remove('active');
    
    if (data.success && data.events && data.events.length > 0) {
      const eventList = document.getElementById('eventList');
      eventList.style.display = 'block';
      eventList.innerHTML = '';
      
      data.events.forEach(event => {
        const item = document.createElement('div');
        item.className = 'event-item';
        item.innerHTML = `
          <span class="material-symbols-rounded event-severity-icon ${event.severity}">
            ${getSeverityIcon(event.severity)}
          </span>
          <div class="event-content">
            <div class="event-header">
              <div class="event-sensor">${event.sensor}</div>
              <div class="event-time">${event.timestamp}</div>
            </div>
            <div class="event-message">${event.event}</div>
          </div>
        `;
        eventList.appendChild(item);
      });
    } else {
      document.getElementById('eventsEmpty').style.display = 'block';
    }
  } catch (error) {
    console.error('Failed to load events:', error);
    document.getElementById('eventsLoading').classList.remove('active');
    document.getElementById('eventsEmpty').style.display = 'block';
  }
}

// Get severity icon
function getSeverityIcon(severity) {
  const icons = {
    'critical': 'error',
    'error': 'warning',
    'warning': 'priority_high',
    'info': 'info'
  };
  return icons[severity] || 'info';
}

// Power operations
function confirmPowerOperation(operation) {
  currentOperation = operation;
  
  const modal = document.getElementById('confirmModal');
  const title = document.getElementById('modalTitle');
  const message = document.getElementById('modalMessage');
  
  const messages = {
    'on': {
      title: 'Power On System',
      message: 'This will turn on the system. Continue?'
    },
    'off': {
      title: 'Power Off System',
      message: 'This will forcefully shut down the system. All unsaved data will be lost. Continue?'
    },
    'reset': {
      title: 'Reset System',
      message: 'This will immediately reset the system. All unsaved data will be lost. Continue?'
    },
    'cycle': {
      title: 'Power Cycle System',
      message: 'This will power off and then on the system. All unsaved data will be lost. Continue?'
    }
  };
  
  title.textContent = messages[operation].title;
  message.textContent = messages[operation].message;
  modal.classList.add('active');
}

async function executePowerOperation() {
  closeModal();
  
  if (!currentOperation) return;
  
  await doPowerOperation(currentOperation);
  currentOperation = null;
}

async function doPowerOperation(operation) {
  try {
    const needsConfirm = ['off', 'reset', 'cycle'].includes(operation);
    const url = `${API_BASE}?action=power&operation=${operation}${needsConfirm ? '&confirm=true' : ''}`;
    
    const response = await fetch(url, {
      method: 'POST',
      headers: {
        'X-CSRF-Token': getCSRFToken()
      }
    });
    
    const data = await response.json();
    
    if (data.success) {
      showToast(`Power operation "${operation}" completed successfully`, 'success');
      
      // Update power state if status
      if (operation === 'status' && data.output) {
        document.getElementById('powerState').textContent = data.output;
      }
    } else {
      showToast(data.error || 'Power operation failed', 'error');
    }
  } catch (error) {
    console.error('Power operation failed:', error);
    showToast('Failed to execute power operation', 'error');
  }
}

function closeModal() {
  document.getElementById('confirmModal').classList.remove('active');
}

// Check permissions and disable power controls if not admin
async function checkPermissions() {
  try {
    const response = await /* Auth handled by session middleware */ Promise.resolve({json: () => ({allowed: true})});
    const data = await response.json();
    
    if (!data.has_permission) {
      document.getElementById('powerSection').classList.add('admin-only');
    }
  } catch (error) {
    console.error('Failed to check permissions:', error);
    document.getElementById('powerSection').classList.add('admin-only');
  }
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  checkIPMIStatus();
  checkPermissions();
});

// Cleanup on page unload
window.addEventListener('beforeunload', () => {
  if (refreshInterval) {
    clearInterval(refreshInterval);
  }
});
</script>

</body>
</html>